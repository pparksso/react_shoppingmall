# react_shoppingmall

## 진행상황

- API 연동(결제, 장바구니)
- 반응형

## 서버쪽 해야할 것

- 카카오페이API, 결제, 로그인 후 인증페이지들... 안됨 하...

## 수정하고 싶은 부분들

- 로그인 인증, 로그아웃, 페이지네이션,

## error

1. Expected `onClick` listener to be a function, instead got a value of `object` type.

- redux-toolkit을 사용하다 만난 에러, 페이지 번호를 누르면 페이지번호와 카테고리를 리덕스로 넘겨주는 함수를 onclick에 담았는데 그냥 dispatch로 보내서 난 에러, ()=>이렇게 함수 형태로 보내야한다!(온클릭 이벤트에도 마찬가지로 적용된다. 함수형태로 보내지 않으면 랜더링 시 클릭하지 않아도 함수가 실행됨)

2. 페이지를 눌렀을 때 깜빡이는 현상

- useEffect의 실행조건에 대해서 더 공부할 수 있었다

3. 페이지네이션을 컴포넌트화하고, 함수를 리듀서로 하나로 사용하다보니 스테이트 값이 각 카테고리마다 리셋되지않고 그대로 페이지값을 가져가는 현상이 있었다. 이것을 해결하기 위해 카테고리를 클릭할 때마다 스테이트값을 1로 다시 변경시켰다.. 이렇게 하는게 아닌 것 같은데... 재렌더링이 몇번이나 되는 것 같다.. 더 좋은 방법을 생각해봐야겠다.

4. 클라이언트와 서버가 쿠키를 공유하고 싶을 때는 credentials 옵션이 양쪽 모두에게 추가되어야한다. 이 경우 'Access-Control-Allow-Origin'이 모두 허용되는 *면 안되는데, cors 모듈을 사용할 경우 기본 설정이 *이기 때문에, origin만 허용하도록 바꿔주어야한다. 그래서 결론적으로 내가 사용한 방법은, 서버쪽에서는

```javascript
app.use(
  cors({
    credentials: true,
    origin: true,
  })
);
```

클라이언트에서는 withCredentials: true, 를 옵션으로 넣어주었다!

5. 서버측에서 클라이언트의 쿠키에 토큰을 저장할 때 httponly를 하면 클라이언트에서 토큰을 읽지 못한다. httponly 옵션은 브라우저에서 쿠키에 접근할 수 없도록(CSS 등) 제한하는 옵션인데, 이 옵션으로 인해 클라이언트측의 어떤 자바스크립트코드도 쿠키에 접근하지 못하게 된다. 로그인 인증에 대해서 다른 방법이 없나 생각해봐야할 것 같다.(내가 구현한 방식은, 로그인 시 서버에서 클라이언트의 쿠키에 토큰을 저장하고, db에 같은 토큰을 저장하고 난 후, 인증은 그 db에 있는 토큰과 클라이언트에 있는 토큰이 맞는지 확인하는 방법이다.)

6. 토큰을 만들 때 db에 저장된 \_id 를 섞어서 만들어 로그인 시 그 토큰을 verify 하여 나온 id로 로그인 인증로직을 만들었는데, 카카오 로그인은 아무것도 verify되지 않은 토큰이었기 때문에 로그인 인증 로직에 문제가 생겼다. 그래서 인증 자체를 그냥 토큰만 대조하는 것으로 바꾸게 되었다.
